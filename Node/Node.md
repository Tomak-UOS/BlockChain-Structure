# 노드

목차
1. 노드의 개념
2. 블록체인 노드의 구조
3. 노드의 종류
4. 마스터 노드

## 1. 노드의 개념

노드에 대해 간단하게 개념을 정리하자면 아래와 같은 그림에서 변과 함께 그래프를 구성하는 요소의 하나이다. 즉 A~I 로 나타나는 부분을 노드라고 한다.

![노드](http://cfile27.uf.tistory.com/image/190B080C4BE0071978ACB3)

블록체인에서는 노드의 개념을 아래와 같이 정리할 수 있다.

1. 네트워크에 접속할 수 있으며
2. 거래의 유효성을 검증하여
3. 인접노드에게 해당 내용을 전파하는 작업을 수행하고
4. 트랜잭션 내역을 보관하는 장치

## 2. 블록체인 노드의 구조

![노드의 구조](https://loopchain.files.wordpress.com/2017/03/e18489e185b3e1848fe185b3e18485e185b5e186abe18489e185a3e186ba-2017-03-13-e1848be185a9e18492e185ae-2-43-49.png?w=676&h=353)

위 그림은 대략적인 노드의 구조와 트랜잭션이 발생했을 때 처리하는 과정을 보여주고 있다.

이 과정을 좀 더 세분화 해서 살펴보자.

1. A가 B에게 송금을 하기 위한 트랜잭션 발생
2. 노드에서 해당 송금 요청이 Consensus Rule에 맞는 유효한 거래인지 확인.
3. 유효하다고 판정 된 블록체인 네트워크에 전파
4. 블록을 생성하는 노드에서 트랜잭션을 Mempool(미채굴 거래 대기목록)에 올려놓음
5. 마이너들은 Mempool에 대기 중인  트랜잭션에서 송금 수수료가 높은 거래를 우선적으로 선별
6. 블록을  생성하여 노드에 전파하고 노드는 장부를 갱신

위 과정을 살펴보면 노드와 마이너의 역할의 차이를 볼 수 있다.
- 노드의 Consensus Rule에 의한 동작 예시
  - 즉 송금액이 잔고 보다 작은가
  - 유효한 주소인가
  - 개인키가 유효한가
  - 데이터 포맷이 맞는가 등을 검증

- 마이닝의 동작 예시
  - 참조하고 있는 이전 블록이 존재하고 유효한가
  - 현재 블록의 타임스탬프가 참조하고 있는 이전의 블록의 타임스탬프보다 큰가
  - 블록에 포함된 작업 증명이 유효한가 등을 검증

## 3. 노드의 종류

블록체인을 구성하는 노드는 크게 2가지로 나누어진다.

1. 풀 노드(Full Node)
2. 라이트웨이트 노드(Lightweight Node)

노드에 대해 보기 전에 먼저 노드를 구성하는 요소에 대해서 먼저 확인하겠다. 노드는 4가지의 구성 요소로 이루어져 있다.
 1. 지갑(Wallet)
 2. 풀 블록체인(Full Block Chain)
 3. 마이너(Miner)
 4. 라우팅(Routing)

![노드 구성 요소](http://i63.tinypic.com/23ur2vd.png)

위 요소 중 어떤 것을 가지고 있는가에 따라서 노드의 종류가 다르다. 지금부터 요소에 따른 노드의 종류를 살펴보자.

### 1. 풀 노드(Full Node)

![풀 노드](http://i63.tinypic.com/2pyynp4.png)

풀 노드는 위와 같이 풀 블록체인 가지고 있는 노드를 의미한다. 풀 노드는 다시 3가지 종류로 구분할 수 있다.

 - 비트코인의 경우 지갑, 풀 블록체인, 마이닝, 라우팅 기능을 모두 가지고 있는 비트코인 코어와 같은 노드
 - 풀 블록체인과 라우팅 기능만 가지고 네트워크의 엣지 라우터(Edge Router)¹ 역할을 Full Block Chain Node
 - 풀 블록체인 노드에서 마이닝 기능이 Solo Miner

### 2. 라이트웨이트 노드(Lightweight Node)

![라이트웨이트 노드](http://i64.tinypic.com/123tq1g.png)

라이트웨이트 노드는 풀 블록체인을 가지고 있지 않은 노드를 말한다.

라이트웨이트 노드도 4가지 종류로 구분할 수 있다.
- 블록의 헤더만 가져 풀 블록체인보다 훨씬 작은 용량으로 유지되는 Lightweight wasllet
- P2P 네트워크에 접속하는 게이트웨이 역할을 하는 Pool Protocol Server
- 위의 Pool Protocol Server 에 연결되어 마이닝에 참여하는 Mining Node
- Stratum protocol 을 사용하는 Stratum wallet.

위와 같이 노드의 종류가 다양한 이유는 노드의 구성 요소 4가지의 기능을 모두 가지고 있는 노드는 많지 않기 때문에 이를 보안하기 위한 Stratum 과 Pool 같은 프로토콜이 이용되면서 더욱 다양해졌다.

비트코인 네트워크에서의 전체적인 노드 구조는 아래와 같다.

![비트코인의 노드 구조](https://steemitimages.com/0x0/https://4.bp.blogspot.com/-frYarZUGAYQ/WpURk0ztZpI/AAAAAAAAAiI/WMLqwMaBRyAKS4PuVXtf8mfZI39DbrfoQCLcBGAs/s640/node_network.png)

## 4. 마스터 노드

마스터 노드는 PoS(Proof of Stake) 방식을 이용해 마이닝을 수행하는 노드를 의미한다. 즉 마이닝을 수행하려면 일정 지분 이상의 코인을 마스터 노드의 지갑에 묶어 두어야 한다는 것이다. 따라서 PoW 에 비교하여 상대적으로 전력 소모량이 적고, 마이닝을 위한 기기를 구매하는 것이 아닌 코인을 구매하는 방식에서 차이를 보인다.

이 방식으로 마이닝을 하기 위해 마스터 노드를 호스팅할 서버를 직접 설정하는 방법(Solo Mining과 유사)이 있고, 이 일을 대신 해주는 대행업체를 이용하는 방법(Mining Pool에 참가하는 Mining node가 되는 방법)이 있다.

-----
¹ 엣지 라우터(Edge Router): 어떤 네트워크가 외부 네트워크에 연결할 수 있도록 네트워크 경계에 위치한 특수 라우터
